name: CD Scripts ðŸ§¾ for Web Branches âœ” 

on:
  push:
    branches:
      - web

jobs:
  StoryBook:
    name: Build StoryBook ðŸ“š
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code ðŸ“¦
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup node ðŸ“¦
        uses: actions/setup-node@v2
        with:
          node-version: '20.11.0'
          cache: 'npm'
          cache-dependency-path: '**/package-lock.json'

      - name: Install dependencies ðŸ“¦
        run: cd noplus-web && npm i

      - name: Build Storybook ðŸ“š
        run: cd noplus-web && npm run build-storybook

      - name: Send Build to Upload Authority
        uses: actions/upload-artifact@v2
        with:
          name: storybook
          path: noplus-web/storybook-static

  StoryDocs:
    name: Build StoryDocs ðŸ“š
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code ðŸ“¦
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup node ðŸ“¦
        uses: actions/setup-node@v2
        with:
          node-version: '20.11.0'
          cache: 'npm'
          cache-dependency-path: '**/package-lock.json'

      - name: Install dependencies ðŸ“¦
        run: cd noplus-web && npm i

      - name: Build StoryDocs ðŸ“š
        run: cd noplus-web && npm run build-storydocs

      - name: Send Build to Upload Authority
        uses: actions/upload-artifact@v2
        with:
          name: storydocs
          path: noplus-web/storybook-static

  upstream:
    name: Upload Authority ðŸ“¦
    runs-on: ubuntu-latest
    permissions:
      contents: write
      packages: write
      pull-requests: write
    needs: [StoryBook, StoryDocs]
    steps:
      - name: Checkout code ðŸ“¦
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Download Storybook ðŸ“š
        uses: actions/download-artifact@v2
        with:
          name: storybook
          path: docs/storybook

      - name: Download StoryDocs ðŸ“š
        uses: actions/download-artifact@v2
        with:
          name: storydocs
          path: noplus-web/public/storydocs

      - name: Upload Authority ðŸ“¦
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: 'Update from workflow'

